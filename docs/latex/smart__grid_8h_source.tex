\doxysection{smart\+\_\+grid.\+h}
\hypertarget{smart__grid_8h_source}{}\label{smart__grid_8h_source}\index{include/smart\_grid.h@{include/smart\_grid.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <random>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <ctime>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}json.hpp"{}}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{using\ }json\ =\ nlohmann::json;}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_energy_producer_acee21f6c663f7a6d7dc8a99b3b06deae}{EnergyProducer}}\ \{}
\DoxyCodeLine{00019\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordtype}{int}\ id;}
\DoxyCodeLine{00021\ \ \ \ \ std::string\ type;\ \ \textcolor{comment}{//\ "{}solar"{},\ "{}wind"{},\ "{}grid"{}}}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{double}\ capacity;\ \ \ \textcolor{comment}{//\ Maximum\ capacity\ (kW)}}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{double}\ current\_output;\ \ \textcolor{comment}{//\ Current\ Production\ (kW)}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{class_energy_producer_acee21f6c663f7a6d7dc8a99b3b06deae}{EnergyProducer}}(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ std::string\ type,\ \textcolor{keywordtype}{double}\ capacity)}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ :id(id),\ type(type),\ capacity(capacity),\ current\_output(0.0)\ \{\}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_energy_producer_afb7fc2b4982d45da3e4c09671c44e227}{update\_output}}(\textcolor{keywordtype}{double}\ current\_time)\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \textcolor{stringliteral}{"{}solar"{}})\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ solar\_factor\ =\ std::max(0.0,\ 1.0\ -\/\ std::abs((current\_time\ -\/\ 12.0)\ /\ 6.0));\ \textcolor{comment}{//\ Peak\ at\ noon}}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ current\_output\ =\ capacity\ *\ solar\_factor\ *\ (0.8\ +\ 0.2\ *\ (((double)\ rand()\ /\ (RAND\_MAX))\ +\ 1));\ \textcolor{comment}{//\ Random\ varation\ between\ 80\%\ and\ 100\%}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \textcolor{stringliteral}{"{}wind"{}})\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ wind\_factor\ =\ 0.3\ +\ 0.7\ *\ (((double)\ rand()\ /\ (RAND\_MAX))\ +\ 1);\ \textcolor{comment}{//\ Wind\ between\ 30\%\ and\ 100\%\ of\ its\ capacity}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ current\_output\ =\ capacity\ *\ wind\_factor;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ Grid\ (Main\ grid)}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ current\_output\ =\ capacity;}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_energy_producer_ab1cb3881a5b5247f24023b15957a81c8}{isEqual}}(\textcolor{keywordtype}{int}\ producerId)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ producerId\ ==\ id;}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00058\ \};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_energy_consumer_aa47328f6fc869ce76333e29d8ebbeed1}{EnergyConsumer}}\ \{}
\DoxyCodeLine{00066\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{int}\ id;}
\DoxyCodeLine{00068\ \ \ \ \ std::string\ type;\ \ \textcolor{comment}{//\ "{}household"{},\ "{}industry"{}}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{double}\ demand;\ \ \ \ \ \textcolor{comment}{//\ Actual\ Demand\ (kW)}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{class_energy_consumer_aa47328f6fc869ce76333e29d8ebbeed1}{EnergyConsumer}}(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ std::string\ type,\ \textcolor{keywordtype}{double}\ base\_demand)}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ :id(id),\ type(type),\ demand(base\_demand)\ \{\}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_energy_consumer_a4fae44f715451dc1bebbfc8cb0fd6e26}{update\_demand}}(\textcolor{keywordtype}{double}\ current\_time)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Demand\ variation\ over\ time\ }}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \textcolor{stringliteral}{"{}household"{}})\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Peak\ in\ the\ morning\ (7h\ -\/\ 9h)\ and\ in\ the\ evening\ (18h\ -\/\ 22h)}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ demand\ =\ 2.0\ +\ 5.0\ *\ (}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::exp(-\/0.5\ *\ std::pow((current\_time\ -\/\ 8)\ /\ 2,\ 2))\ +\ \textcolor{comment}{//\ Peak\ the\ morning}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::exp(-\/0.5\ *\ std::pow((current\_time\ -\/\ 20)\ /\ 2,\ 2))\ \textcolor{comment}{//\ Peak\ the\ evening}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ Industry}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ demand\ =\ 50.0\ +\ 30.0\ *\ std::exp(-\/0.5\ *\ std::pow((current\_time\ -\/\ 12)\ /\ 6,\ 2));\ \ \textcolor{comment}{//\ Constant\ demand\ with\ a\ slight\ peak\ at\ midday}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_energy_consumer_a44d5c502dcf776eef2885d0d5dc168d4}{isEqual}}(\textcolor{keywordtype}{int}\ consumerId)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{id}\ ==\ consumerId;}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00112\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_battery_adfb929b8c7e12bcf92f4038b538a51dc}{Battery}}\ \{}
\DoxyCodeLine{00113\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{double}\ capacity;\ \ \ \textcolor{comment}{//\ Total\ Capacity\ (kWh)}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{double}\ stored\_energy;\ \ \textcolor{comment}{//\ Stored\ Energy\ (kWh)}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_charge\_rate;\ \ \textcolor{comment}{//\ Maximum\ charging\ power\ (kW)}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_discharge\_rate;\ \ \textcolor{comment}{//\ Maximum\ discharge\ power\ (kW)}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{class_battery_adfb929b8c7e12bcf92f4038b538a51dc}{Battery}}(\textcolor{keywordtype}{double}\ capacity,\ \textcolor{keywordtype}{double}\ charge\_rate)}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ :\ capacity(capacity),\ stored\_energy(capacity\ /\ 2),}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ max\_charge\_rate(charge\_rate),\ max\_discharge\_rate(charge\_rate)\ \{\}}
\DoxyCodeLine{00127\ \ \ \ \ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_battery_a51c3cde9b9e6aa1948a7a6b4548a9ec3}{update}}(\textcolor{keywordtype}{double}\ newCapacity,\ \textcolor{keywordtype}{double}\ newCharge\_rate)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ capacity\ =\ newCapacity;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ stored\_energy\ =\ newCapacity\ /\ 2;}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ max\_charge\_rate\ =\ newCharge\_rate;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ max\_discharge\_rate\ =\ newCharge\_rate;}
\DoxyCodeLine{00138\ \ \ \ \ \};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_battery_a1984c60f05cbbc190e3101ec62eeb51e}{charge}}(\textcolor{keywordtype}{double}\ energy,\ \textcolor{keywordtype}{double}\ delta\_time)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_energy\ =\ max\_charge\_rate\ *\ delta\_time\ /\ 3600;\ \ \textcolor{comment}{//\ kWh}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ energy\_to\_store\ =\ std::min(energy,\ max\_energy);}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ stored\_energy\ =\ std::min(stored\_energy\ +\ energy\_to\_store,\ capacity);}
\DoxyCodeLine{00149\ \ \ \ \ \}}
\DoxyCodeLine{00150\ \ \ \ \ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_battery_ac140703fc3c2213c81bb80fdbe57613a}{reset}}()\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ stored\_energy\ =\ capacity\ /\ 2;}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{class_battery_a8f47cb436c6f4a04b61f964df1204859}{discharge}}(\textcolor{keywordtype}{double}\ energy\_needed,\ \textcolor{keywordtype}{double}\ delta\_time)\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_energy\ =\ max\_discharge\_rate\ *\ delta\_time\ /\ 3600;\ \ \textcolor{comment}{//\ kWh}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ energy\_to\_release\ =\ std::min(std::min(energy\_needed,\ max\_energy),\ stored\_energy);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ stored\_energy\ -\/=\ energy\_to\_release;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ energy\_to\_release;}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ \};}
\DoxyCodeLine{00176\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_smart_grid_a3888559a4e75f425843f4cc5a42556ff}{SmartGrid}}\ \{}
\DoxyCodeLine{00177\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00178\ \ \ \ \ std::vector<EnergyProducer>\ producers;}
\DoxyCodeLine{00179\ \ \ \ \ std::vector<EnergyConsumer>\ consumers;}
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{class_battery}{Battery}}\ battery;}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{double}\ time\_step;\ \ \textcolor{comment}{//\ Secondes}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{double}\ current\_time;\ \ \textcolor{comment}{//\ Heures\ (0-\/24)}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{double}\ purchase\_energy;\ \textcolor{comment}{//\ kWh\ purchased\ from\ the\ main\ grid}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{class_smart_grid_a3888559a4e75f425843f4cc5a42556ff}{SmartGrid}}(\textcolor{keywordtype}{double}\ battery\_capacity,\ \textcolor{keywordtype}{double}\ charge\_rate,\ \textcolor{keywordtype}{double}\ time\_step=3600)}
\DoxyCodeLine{00193\ \ \ \ \ :\ battery(battery\_capacity,\ charge\_rate),\ time\_step(time\_step),\ current\_time(0.0),\ purchase\_energy(0.0)\ \{\}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_ae0a55d78e67cf77ba428e227e16a0dca}{add\_producer}}(\mbox{\hyperlink{class_energy_producer}{EnergyProducer}}\ producer)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ producers.push\_back(producer);}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \ \ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_ad5ec4142240454695ff8d859e6fa7d68}{remove\_producer}}(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ producers.erase(producers.begin()\ +\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{keywordtype}{id}\ <<\ \textcolor{stringliteral}{"{}\ Removed\ !"{}}\ <<\ std::endl;}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_ae12833b6baf93d3b4b322771222f77a7}{add\_consumer}}(\mbox{\hyperlink{class_energy_consumer}{EnergyConsumer}}\ consumer)\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ consumers.push\_back(consumer);}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_a25422c2604d24ee0c5265316e405d01c}{remove\_consumer}}(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ consumers.erase(consumers.begin()\ +\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{keywordtype}{id}\ <<\ \textcolor{stringliteral}{"{}\ Removed\ !"{}}\ <<\ std::endl;}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_ad80246c1b2a921b2f8ecfa2bfb1d41cd}{updateBattery}}(\textcolor{keywordtype}{double}\ capacity,\ \textcolor{keywordtype}{double}\ charge\_rate)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ battery.update(capacity,\ charge\_rate);}
\DoxyCodeLine{00234\ \ \ \ \ \}}
\DoxyCodeLine{00235\ \ \ \ \ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_a04d52ec9e99cb5cb658c4b94f98da9dd}{reset}}()\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ producers.clear();}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ consumers.clear();}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ battery.reset();}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ current\_time\ =\ 0.0;}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_smart_grid_a97ab3042a115951be2986fae3a094283}{update}}()\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ current\_time\ +=\ time\_step\ /\ 3600.0;}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_time\ >=\ 24.0)\ current\_time\ -\/=\ 24.0;\ \ \textcolor{comment}{//\ Cycle\ de\ 24h}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mettre\ à\ jour\ la\ production\ et\ la\ demande}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ time\_factor\ =\ 0.5\ *\ (1.0\ +\ sin(M\_PI\ *\ current\_time\ /\ 12.0));\ \ \textcolor{comment}{//\ Variation\ journalière}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ producer\ :\ producers)\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ producer.update\_output(current\_time);}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ consumer\ :\ consumers)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ consumer.update\_demand(current\_time);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculer\ l'équilibre\ offre/demande}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ total\_production\ =\ 0.0;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ producer\ :\ producers)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ total\_production\ +=\ producer.current\_output;}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ total\_demand\ =\ 0.0;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ consumer\ :\ consumers)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ total\_demand\ +=\ consumer.demand;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ imbalance\ =\ total\_production\ -\/\ total\_demand;}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ energy\ =\ 0.0;}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (imbalance\ >\ 0)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Excédent\ :\ stocker\ dans\ la\ batterie}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ battery.charge(imbalance\ *\ (time\_step\ /\ 3600.0),\ time\_step);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ energy\ =\ imbalance;}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ purchase\_energy\ =\ 0.0;}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Déficit\ :\ utiliser\ la\ batterie}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ energy\_needed\ =\ -\/imbalance\ *\ (time\_step\ /\ 3600.0);}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ energy\_from\_battery\ =\ battery.discharge(energy\_needed,\ time\_step);}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (energy\_from\_battery\ <\ energy\_needed)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ energy\ =\ energy\_needed\ -\/\ energy\_from\_battery;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ purchase\_energy\ =\ energy;}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Acheter\ de\ l'énergie\ au\ réseau\ principal}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Purchasing\ additional\ energy\ from\ the\ grid\ :\ "{}}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ energy\ <<\ \textcolor{stringliteral}{"{}\ kWh"{}}\ <<\ std::endl;}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00299\ \ \ \ \ json\ \mbox{\hyperlink{class_smart_grid_a661af59a4f77067bd8b8e46c7a5ea663}{get\_state}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ json\ state;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ state[\textcolor{stringliteral}{"{}time"{}}]\ =\ current\_time;}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ state[\textcolor{stringliteral}{"{}battery"{}}]\ =\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}stored\_energy"{}},\ battery.stored\_energy\},}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}capacity"{}},\ battery.capacity\}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ json\ producers\_state;}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ producer\ :\ producers)\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ producers\_state[producer.type]\ =\ producer.current\_output;}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ state[\textcolor{stringliteral}{"{}producers"{}}]\ =\ producers\_state;}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ json\ consumers\_state;}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ consumer\ :\ consumers)\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ consumers\_state[consumer.type]\ =\ consumer.demand;}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ state[\textcolor{stringliteral}{"{}consumers"{}}]\ =\ consumers\_state;}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ state[\textcolor{stringliteral}{"{}purchase\_energy"{}}]\ =\ purchase\_energy;}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00320\ \ \ \ \ \}}
\DoxyCodeLine{00321\ \};}
\DoxyCodeLine{00322\ }

\end{DoxyCode}
